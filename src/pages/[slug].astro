---
import BaseLayout from "../layouts/BaseLayout.astro";
import Prose from "../components/Prose.astro";
import { Image } from "astro:assets";

export function getStaticPaths() {
  return Object.values(
    import.meta.glob("../../writings/*.md", { eager: true }),
  ).map((writing) => {
    const filename = writing.file.split("/").pop();
    const { date, slug } =
      /^(?<date>\d{4}-\d{2}-\d{2})-(?<slug>[\w-]+)\.md$/.exec(filename).groups;

    return {
      params: { slug },
      props: { writing, date },
    };
  });
}

const { writing, date } = Astro.props;
---

<BaseLayout>
  <header
    class="relative h-96 overflow-hidden my-20 -mx-10 p-10 flex items-end bg-gradient-to-t from-emerald-50/90 to-emerald-50/20 rounded-xl shadow-xl"
  >
    {
      writing.frontmatter.cover && (
        <Image
          src={import(`../../writings/images/${writing.frontmatter.cover}`)}
          alt=""
          class="object-cover absolute -z-10 top-0 left-0"
        />
      )
    }
    <div>
      <h1
        class="mb-4 font-mono text-5xl font-bold tracking-tighter leading-snug"
      >
        {writing.frontmatter.title}
      </h1>
      <span>{date}</span>
    </div>
  </header>

  <Prose>
    <writing.Content />
  </Prose>
</BaseLayout>
